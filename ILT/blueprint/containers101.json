{"status":{},"spec":{"description":"* [Instructor Deck](https:\/\/nutanixinc-my.sharepoint.com\/:p:\/g\/personal\/jose_gomez_nutanix_com\/EYoAmv8s7adDh1eky3Jj_p8BeW_P4xUJMtVBdO82VIPzbQ?e=wbSPnh)\n* [Lab Guide](https:\/\/github.com\/pipoe2h\/containers101)\n* [Harbor](http:\/\/@@{subHarbor.address}@@)","resources":{"client_attrs":{"73491825_deployment":{"y":89.6602418776,"x":438.1770349311},"d1cf77bc_deployment":{"y":257.5,"x":213},"9a045da9_deployment":{"y":91,"x":-0.921875}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"29c9be2f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a720d281_runbook","main_task_local_reference":{"kind":"app_task","name":"29c9be2f_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"17c5fae9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"34b112fb_runbook","main_task_local_reference":{"kind":"app_task","name":"17c5fae9_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0a6bb430_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d94cc5db_runbook","main_task_local_reference":{"kind":"app_task","name":"0a6bb430_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"640a23dd_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"56ded883_runbook","main_task_local_reference":{"kind":"app_task","name":"640a23dd_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5b8d00c8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2a7cb1d0_runbook","main_task_local_reference":{"kind":"app_task","name":"5b8d00c8_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"RancherOS","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RegistryCache"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ConfigureRegistry"}],"name":"5c82cad0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"RegistryCache"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConfigureRegistry","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo bash -c 'cat > \/mnt\/registry\/config.yml << EOF\nversion: 0.1\nlog:\n  fields:\n    service: registry\nstorage:\n  cache:\n    blobdescriptor: inmemory\n  filesystem:\n    rootdirectory: \/var\/lib\/registry\nhttp:\n  addr: :5000\n  headers:\n    X-Content-Type-Options: [nosniff]\nhealth:\n  storagedriver:\n    enabled: true\n    interval: 10s\n    threshold: 3\nproxy:\n  remoteurl: @@{REMOTE_REGISTRY}@@\nEOF'\nsudo docker run -d -p 5000:5000  --restart=always --name DockerRegistryCache -v \/mnt\/registry:\/var\/lib\/registry registry:2 \/var\/lib\/registry\/config.yml\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"8e84cd22_runbook","main_task_local_reference":{"kind":"app_task","name":"5c82cad0_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RegistryCache"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"af249925_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"06eecde8_runbook","main_task_local_reference":{"kind":"app_task","name":"af249925_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RegistryCache"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"937f2fa9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f8ec8616_runbook","main_task_local_reference":{"kind":"app_task","name":"937f2fa9_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RegistryCache"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3837858f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9f194cd4_runbook","main_task_local_reference":{"kind":"app_task","name":"3837858f_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"RegistryCache"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7d4f66c2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b702db77_runbook","main_task_local_reference":{"kind":"app_task","name":"7d4f66c2_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"RegistryCache","port_list":[{"target_port":"5000","protocol":"TCP","endpoint_name":"REGISTRY"}],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Harbor Install"},{"kind":"app_task","name":"Harbor CLI Install"},{"kind":"app_task","name":"Harbor environment configuration"}],"name":"03c07924_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Harbor Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Harbor CLI Install"}},{"from_task_reference":{"kind":"app_task","name":"Harbor CLI Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Harbor environment configuration"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Harbor Install","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncurl -sLO https:\/\/storage.googleapis.com\/harbor-releases\/harbor-offline-installer-@@{HARBOR_VERSION}@@.tgz\n#curl -sLO http:\/\/10.10.56.40\/images\/harbor-offline-installer-v1.5.4.tgz\ntar xzf harbor-offline-installer-@@{HARBOR_VERSION}@@.tgz\n\ncd harbor\nsed -i -e 's\/reg.mydomain.com\/harbor.@@{DOMAIN}@@\/g' harbor.cfg\nsudo .\/install.sh --with-clair","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Harbor CLI Install","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nsudo yum --enablerepo=extras install -y epel-release --quiet\nsudo yum install -y python-pip --quiet\nsudo pip install -q python-harborclient","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Harbor environment configuration","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nfor i in {1..@@{HARBOR_USERS}@@}\ndo\n\tharbor --os-baseurl http:\/\/localhost --os-username admin --os-password Harbor12345 \\\n    --os-project 1 user-create --username user$i --password @@{HARBOR_USERS_PASSWORD}@@ \\\n    --email user$i@nutanix.com\n    curl -k -X POST -u admin:Harbor12345 --header \"Content-Type: application\/json\" \\\n    --header \"Accept: application\/json\" \\\n    -d \"{ \\\"role_id\\\": 2, \\\"member_user\\\": { \\\"username\\\": \\\"user$i\\\" } }\" \\\n    \"http:\/\/localhost\/api\/projects\/1\/members\"\ndone\n\ncurl -k -X PUT -u admin:Harbor12345 --header \"Content-Type: application\/json\" \\\n    --header \"Accept: application\/json\" \\\n    -d \"{ \\\"metadata\\\": { \\\"public\\\": \\\"true\\\", \\\"enable_content_trust\\\": \\\"false\\\", \\\"prevent_vul\\\": \\\"false\\\", \\\"severity\\\": \\\"low\\\", \\\"auto_scan\\\": \\\"true\\\" } }\" \\\n    \"http:\/\/localhost\/api\/projects\/1\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"add78620_runbook","main_task_local_reference":{"kind":"app_task","name":"03c07924_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4eae59dc_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"98a1ad65_runbook","main_task_local_reference":{"kind":"app_task","name":"4eae59dc_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"554b4f51_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"67e1e56a_runbook","main_task_local_reference":{"kind":"app_task","name":"554b4f51_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"22e2eee3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"56a0c61f_runbook","main_task_local_reference":{"kind":"app_task","name":"22e2eee3_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"946c43ad_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ce3b2171_runbook","main_task_local_reference":{"kind":"app_task","name":"946c43ad_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Harbor","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"SubRancherOS","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"SSH_CRED"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"rancheros-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"feb085db-56c0-4231-8cd3-df2c6f6d5b71"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1300,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nssh_authorized_keys:\n  - @@{INSTANCE_PUBLIC_KEY}@@\n\nrancher:\n  console: centos\n  bootstrap_docker:\n    registry_mirror: \"http:\/\/@@{SubRegistryCache.address}@@:5000\"\n  docker:\n    registry_mirror: \"http:\/\/@@{SubRegistryCache.address}@@:5000\"\n    insecure_registry:\n      - \"@@{subHarbor.address}@@\"\n  system_docker:\n    registry_mirror: \"http:\/\/@@{SubRegistryCache.address}@@:5000\"    \n    \n    \n "},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"RancherOS_KVM","uuid":"fd6e381f-0580-4448-bb4a-5890b6c033ba"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"SubRegistryCache","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"registry-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"feb085db-56c0-4231-8cd3-df2c6f6d5b71"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nchpasswd:\n  list: |\n    centos:@@{INSTANCE_PASSWORD}@@\n  expire: False\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_KVM","uuid":"b80709a9-8510-a4dd-8f2c-a4f0399c0b1e"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"subHarbor","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"harbor-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"feb085db-56c0-4231-8cd3-df2c6f6d5b71"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nchpasswd:\n  list: |\n    centos:@@{INSTANCE_PASSWORD}@@\n  expire: False\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_KVM","uuid":"b80709a9-8510-a4dd-8f2c-a4f0399c0b1e"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":40960,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"rancher","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"SSH_CRED"},{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS_CRED"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"RancherOS"}],"name":"ConfigureRancherOSSandbox","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ConfigureRancherOSSandbox"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Rancher User Password"},{"kind":"app_task","name":"Install Containerised Tools"},{"kind":"app_task","name":"Install kubectl"},{"kind":"app_task","name":"Reboot VM"}],"name":"df8a7ce5_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Rancher User Password"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Containerised Tools"}},{"from_task_reference":{"kind":"app_task","name":"Install Containerised Tools"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install kubectl"}},{"from_task_reference":{"kind":"app_task","name":"Install kubectl"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Reboot VM"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Set Rancher User Password","state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\nsudo system-docker run --rm -it -v \/:\/host alpine sed  -i '\/panic\/s\/$\/ rancher.password=@@{INSTANCE_PASSWORD}@@\/' \/host\/boot\/global.cfg","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install Containerised Tools","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\necho 'alias git=\"docker run -ti --rm -v \\\"\\$(pwd)\\\":\/git bwits\/docker-git-alpine\"' >> ~\/.bash_profile\necho 'alias nano=\"docker run -ti --rm -v \\\"\\$(pwd)\\\":\/nano pipoe2h\/rancheros-nano\"' >> ~\/.bash_profile","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"SSH_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install kubectl","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncurl -LO https:\/\/storage.googleapis.com\/kubernetes-release\/release\/$(curl -s https:\/\/storage.googleapis.com\/kubernetes-release\/release\/stable.txt)\/bin\/linux\/amd64\/kubectl\n\n#curl -sLO http:\/\/10.10.56.40\/images\/kubectl\nchmod +x .\/kubectl\nsudo mv .\/kubectl \/usr\/local\/bin\/kubectl\n\n#mkdir ~\/.kube\n#cat <<EOF > ~\/.kube\/config\n# -*- mode: yaml; -*-\n# vim: syntax=yaml\n#\n#apiVersion: v1\n#kind: Config\n#clusters:\n#- name: k8s\n#  cluster:\n#    server: https:\/\/10.10.56.169:443\n#    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURzekNDQXB1Z0F3SUJBZ0lVUzZDMnFWVlBMRElZd1dFeVYzbk9wSnEreHVBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RXpBUkJnTlZCQWdUQ2tOaGJHbG1iM0p1YVdFeEVUQVBCZ05WQkFjVApDRk5oYmlCS2IzTmxNUkF3RGdZRFZRUUtFd2RPZFhSaGJtbDRNUkl3RUFZRFZRUUxFd2xKYm1aeVlTQkJRMU14CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTVRneE1ETXdNak16T0RBd1doY05Namd4TURJM01qTXoKT0RBd1dqQndNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVJNQThHQTFVRQpCeE1JVTJGdUlFcHZjMlV4RURBT0JnTlZCQW9UQjA1MWRHRnVhWGd4RWpBUUJnTlZCQXNUQ1VsdVpuSmhJRUZEClV6RVRNQkVHQTFVRUF4TUtTM1ZpWlhKdVpYUmxjekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0MKQVFvQ2dnRUJBTUVTUUZSbGp2YUVxTS91QitMZjNEZTBmTVpvNkZFRHExM0JWN3ROM3A4eWMwWm1ZMzY0bjNqNAp0LzJtbkgvN25xdTREaXJtK09CcXRNazE2aGtwQTdvem5jQzAyOGd3M0FSbjZpU052NHd4WWFrQy9DSXdLcTc2CjVMdG15MklWbjcwTkc3QzVaMHFmTnF5dGxOK2I5eVdsUi9PUUV6QlRMZHMrekVrZzlvTkp2dzBtNHlLWXFnb0MKd1pxak9jQSsxVlY2S2s0WEpjNTFzWVpCbm1Lak9adFpWNlBPd0t5V0UxTFNQSmhyT0tsdDJQMVhTSjdNQU5mQQp3N0pLRFNOVHRSbFJ0OFlkbUdYRE9IbEZmMnM4TTk5R0NlS1VLRlhBRHJreGZId09MWTYzVFBtbnhiWTU0TzgyCm5kSlhTclBNdDM1UTFndTcxdEZ6WFhaZHJhdEVGRmtDQXdFQUFhTkZNRU13RGdZRFZSMFBBUUgvQkFRREFnRUcKTUJJR0ExVWRFd0VCL3dRSU1BWUJBZjhDQVFJd0hRWURWUjBPQkJZRUZINUI4WUJPMUlVTEFGODIwVWtiRmxaMwo0eTdpTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFBYmRNRTVMZXNhT244cFptcklQU1pPY2NPZnNpNmRNTU1UCmNMN3BNcGtvV2ZiSWdTT09XYm1MY1g0cGRzdlVUMURsVm9XWHZrRVU0cEZGajE3bGJBS1pTTjRqdk9RaE5QMkoKcTBBU0NleTFuRVpULzZwNjNYN2hDOHVSRk9LVHVhSXg5MzdENHN6N1p1TmxkSXg5MXU1ZjNjY0toMFRWVjlCeApYLzVCc1RyRFlCM0p4WmJQdis1RGpVL0F3OFRNdzVDRFE5WGJwNDg1c3RGQUVFdkNUeUpwUWhUWFVHSys5Y2hNCmIyL01jakNjVDNuRnlDa3RGNytnVGNqOXBoSWhtd01Pa2VGVmQxSTFKSUNiYzlNWjhaanhHSWx4TzNhVlBGdnUKd01BNXA0NlNWVVIyOG5BaTNsbXVZWWNKQTZZbXBQd0ZFdnYrSlhFTXJ1aTYzd3BHd3RyWgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==\n#users:\n#- name: default-user\n#  user:\n#    username: admin\n#    password: nutanix\/4u\n#contexts:\n#- context:\n#    cluster: k8s\n#    user: default-user\n#  name: k8s-context\n#current-context: k8s-context\n#EOF","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"SSH_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"RancherOS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Reboot VM","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo -b reboot","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"SSH_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"1f0f2866_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"df8a7ce5_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ConfigureRancherOSSandbox"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"06428b34_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"43d7125f_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"06428b34_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"RancherOS_KVM","version":"","options":{"type":"","name":"RancherOS-1.4.2","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"https:\/\/github.com\/rancher\/os\/releases\/download\/v1.4.2\/rancheros-openstack.img","version":{"product_version":"1.4.2","type":"","product_name":"RancherOS-Openstack"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"RegistryCache"}],"name":"DockerRegistryMirrorAHVPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"DockerRegistryMirrorAHVPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Install"},{"kind":"app_task","name":"Allow SSH password authentication"}],"name":"9dd47c18_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Allow SSH password authentication"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"RegistryCache"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Docker Install","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo yum update -y --quiet\nsudo hostnamectl set-hostname --static docker-registry\nsudo mkdir -p @@{MOUNT_PATH}@@\n#Install Ntp\nsudo yum install -y --quiet ntp\nsudo ntpdate 0.uk.pool.ntp.org\n#Remove any Old docker version\nsudo yum remove docker docker-common container-selinux docker-selinux docker-engine\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet docker-ce-@@{DOCKER_VERSION}@@\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo systemctl start docker\nsudo usermod -a -G docker $USER\n\nsudo yum install -y --quiet lvm2\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t @@{MOUNT_PATH}@@ \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"RegistryCache"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Allow SSH password authentication","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nset -ex\n\nsudo sed -i 's\/PasswordAuthentication no\/PasswordAuthentication yes\/g' \/etc\/ssh\/sshd_config\nsudo systemctl restart sshd","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"b3db7234_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"9dd47c18_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"DockerRegistryMirrorAHVPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"fe0afa2d_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d81dcce0_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"fe0afa2d_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Harbor"}],"name":"InstallHarborAHV","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallHarborAHV"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Install"},{"kind":"app_task","name":"Docker Compose Install"},{"kind":"app_task","name":"Allow SSH password authentication"}],"name":"aa1fb184_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Docker Compose Install"}},{"from_task_reference":{"kind":"app_task","name":"Docker Compose Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Allow SSH password authentication"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Docker Install","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo yum update -y --quiet\nsudo hostnamectl set-hostname --static harbor\nsudo mkdir -p @@{DOCKER_PATH}@@\n\nsudo yum install -y --quiet lvm2\nsudo pvcreate \/dev\/sdb\nsudo vgcreate docker \/dev\/sdb\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t @@{DOCKER_PATH}@@ \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n#Install Ntp\nsudo yum install -y --quiet ntp\nsudo ntpdate 0.uk.pool.ntp.org\n#Remove any Old docker version\nsudo yum remove docker docker-common container-selinux docker-selinux docker-engine\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet docker-ce-@@{DOCKER_VERSION}@@\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock -g @@{DOCKER_PATH}@@' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo systemctl start docker\nsudo usermod -a -G docker $USER\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Docker Compose Install","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo curl -sL \"https:\/\/github.com\/docker\/compose\/releases\/download\/1.22.0\/docker-compose-$(uname -s)-$(uname -m)\" -o \/usr\/local\/bin\/docker-compose\nsudo chmod +x \/usr\/local\/bin\/docker-compose\nsudo ln -s \/usr\/local\/bin\/docker-compose \/usr\/bin","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Harbor"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Allow SSH password authentication","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nset -ex\n\nsudo sed -i 's\/PasswordAuthentication no\/PasswordAuthentication yes\/g' \/etc\/ssh\/sshd_config\nsudo systemctl restart sshd","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS_CRED"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"7640f981_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"aa1fb184_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallHarborAHV"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"739f4e09_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"8710f215_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"739f4e09_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CENTOS_KVM","version":"","options":{"type":"","name":"CentOS-7.4","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"https:\/\/cloud.centos.org\/centos\/7\/images\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"7.4","type":"","product_name":"CentOS-GenericCloud"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","description":"","action_list":[],"editables":{"min_replicas":true,"max_replicas":true},"name":"d1cf77bc_deployment","max_replicas":"30","package_local_reference_list":[{"kind":"app_package","name":"ConfigureRancherOSSandbox"}],"substrate_local_reference":{"kind":"app_substrate","name":"SubRancherOS"},"min_replicas":"1","variable_list":[]},{"type":"GREENFIELD","description":"","action_list":[],"name":"9a045da9_deployment","max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"DockerRegistryMirrorAHVPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"SubRegistryCache"},"min_replicas":"1","variable_list":[]},{"type":"GREENFIELD","description":"","action_list":[],"name":"73491825_deployment","max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"InstallHarborAHV"}],"substrate_local_reference":{"kind":"app_substrate","name":"subHarbor"},"min_replicas":"1","variable_list":[]}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out 1 "}],"name":"abdc7c29_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d1cf77bc_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale Out 1 ","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"7b9efeb9_runbook","main_task_local_reference":{"kind":"app_task","name":"abdc7c29_dag"},"variable_list":[]},"name":"Scale Out"}],"name":"Default","variable_list":[{"val_type":"STRING","description":"","name":"MOUNT_PATH","type":"LOCAL","value":"\/mnt\/registry","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"DOCKER_VERSION","type":"LOCAL","value":"17.09.0.ce","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"REMOTE_REGISTRY","type":"LOCAL","value":"https:\/\/registry-1.docker.io","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"INSTANCE_PUBLIC_KEY","type":"LOCAL","value":"ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAlfStbqnKNNpjH6LBFcbyIbGTkougx9GDfvzUEseWJWdn9oomF0y\/w7yymB+ulzs5Ftx32mWNGAR\/yTGI+OKzVin9B1kmUsHXGmwdGKgSiF26v3ejHOHbLXpRLpm9UwpusxUzwJfnlCFipwjLxTol4ARLliTnvidq1G\/hGttZ5GPozukkuZJLQ0M5I4B0BSqO3mzUmhjlOb5BPSfUUM51loMZ01RzqJAF361\/SPvwQhv0WIB00P10iqlo0Rsost392AW4L4x3vPgdtBIurEV81Ox0M\/N4qBIdtdwh3KSwu4DtqZyAr9PlDnW+w51r53TT1AkHiGJJP03dTjA9aGh4gw== rsa-key-20180407","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"DOCKER_PATH","type":"LOCAL","value":"\/mnt\/docker","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"DOMAIN","type":"LOCAL","value":"ntnxdemo.local","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"HARBOR_VERSION","type":"LOCAL","value":"v1.5.4","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"HARBOR_USERS","type":"LOCAL","value":"15","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"HARBOR_USERS_PASSWORD","type":"SECRET","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"INSTANCE_PASSWORD","type":"SECRET","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"editables":{"value":true}}]}],"default_credential_local_reference":{"kind":"app_credential","name":"SSH_CRED"},"type":"USER"},"name":"Containers101_Public"},"api_version":"3.0","metadata":{"last_update_time":"1541247706247863","kind":"blueprint","spec_version":71,"creation_time":"1540217317946297","name":"Containers101_Public"}}